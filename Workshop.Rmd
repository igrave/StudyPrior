---
title: "Historical data workshop"
author: "Isaac Gravestock"
date: "5 June 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE)
```

## Practical 1: Analysis of clinical trials using single historical control dataset

**Data Description:** Taken from Neuenschwander 2010 clinical trials paper, designing a Phase IV trial comparing a control treatment and a new intensified treatment of the same compound.  The primary outcome is treatment failure (binary). There are 11 internal historical trials of essentially the same trial design. 


```{r data}
x.hist <- c(6,8,17,28,26,8,22,8,6,16,53)
n.hist <- c(33,45,74,103,140,49,83,59,22,109,213)
p.hist <- x.hist/n.hist

x.c <- 12
n.c <- 80

x.t <- 8
n.t <- 80


knitr::kable(data.frame(Study = 1:11,
                        Failures = paste0(x.hist,'/',n.hist),
                        Percent = paste0(round(p.hist*100),'%')),
             col.names = c("Study","Failures/Controls","Failure %"),
             align='c')

```

A new study takes place and there are 12 failures out of 80 controls (15%) and 8 failures out of 80 people on the new intensified treatment (10%).

```{r}

library(StudyPrior)
library(INLA)

pool <- binom.PP.FIX(x=x.hist, n=n.hist, d=1, mix = TRUE)

pp08 <- binom.PP.FIX(x=x.hist, n=n.hist, d=0.8, mix = TRUE)

pp01 <- binom.PP.FIX(x=x.hist, n=n.hist, d=0.1, mix = TRUE)


plot(pool, at=seq(0,1,len=500), xlab="p")
plot(pp08, lines.only=TRUE, col=2, at=seq(0,1,len=500))
plot(pp01, lines.only=TRUE, col=3, at=seq(0,1,len=500))
```

